<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Viewer</title>
    <script src="https://documentcloud.adobe.com/view-sdk/main.js"></script>
</head>
<body>
    <form id="inputForm">
        <label for="roles">Roles:</label>
        <input type="text" id="roles" name="roles" value="CEO"><br><br>
        <label for="industry">Industry:</label>
        <input type="text" id="industry" name="industry" value="Financial Services"><br><br>
        <label for="companyName">Company Name:</label>
        <input type="text" id="companyName" name="companyName" value="ACME"><br><br>
        <label for="participantNames">Participant Names:</label>
        <input type="text" id="participantNames" name="participantNames" value="John Doe"><br><br>
        <label for="companySituation">Company Situation:</label>
        <input type="text" id="companySituation" name="companySituation" value="Company currently has unresolved support issues"><br><br>
        <button type="button" onclick="submitForm()">Submit</button>
    </form>

    <div id="adobe-dc-view"></div>

    <script>
        // Initialize Adobe Embed API
        document.addEventListener("adobe_dc_view_sdk.ready", function () {
            window.adobeDCView = new AdobeDC.View({ clientId: "531f3aca674349c489bbff2682a1e152", divId: "adobe-dc-view" });
            console.log('Adobe Embed API initialized.');
        });

        async function submitForm() {
            const roles = document.getElementById('roles').value;
            const industry = document.getElementById('industry').value;
            const companyName = document.getElementById('companyName').value;
            const participantNames = document.getElementById('participantNames').value;
            const companySituation = document.getElementById('companySituation').value;

            try {
                // Call Power Automate flow
                const response = await fetch('https://prod-15.canadacentral.logic.azure.com:443/workflows/8151b9e5c79a424faddd0961abbc0494/triggers/manual/paths/invoke?api-version=2016-06-01&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=IkqSmmRpGzgxMWKyPqWiTZGfcN7_ymngmde6-ABJZcE', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ roles, industry, companyName, participantNames, companySituation })
                });

                if (!response.ok) {
                    throw new Error('Network response was not ok ' + response.statusText);
                }

                const data = await response.json();
                console.log('Response Data:', data);  // Debug: Inspect the structure of the response

                // Access pdfUrl directly from the data object
                const pdfUrl = data.pdfUrl; 
                console.log('PDF URL:', pdfUrl);

                // Display the PDF directly using Adobe Embed API
                if (pdfUrl && window.adobeDCView) {
                    window.adobeDCView.previewFile({
                        content: { location: { url: pdfUrl } },
                        metaData: { fileName: "index.pdf" }
                    }, {});
                    console.log('PDF is being displayed.');
                } else {
                    console.error('PDF URL not found in response:', data);
                }
            } catch (error) {
                console.error('There was a problem with the fetch operation:', error);
            }
        }
    </script>
</body>
</html>
